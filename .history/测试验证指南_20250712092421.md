# 火焰检测系统测试验证指南

## 问题修复说明

针对"没有接火焰传感器，但上电就显示有火焰信号"的问题，我们进行了以下修复：

### 🔧 修复内容
1. **ADC引脚配置**：为PA1添加上拉电阻，防止悬空
2. **传感器断开检测**：低于800mV判定为传感器断开
3. **基线范围调整**：从500-3000mV调整为1000-3000mV
4. **安全保护**：传感器断开时自动关闭输出

## 🧪 测试步骤

### 1. 无传感器测试
**目的**：验证传感器断开检测功能

**步骤**：
1. 确保PA1引脚没有连接任何传感器
2. 上电启动系统
3. 观察显示屏

**预期结果**：
- ✅ 显示屏显示"000"
- ✅ LED不亮（熄灭状态）
- ✅ 继电器不吸合
- ✅ 无火焰信号输出

### 2. 传感器连接测试
**目的**：验证正常传感器连接时的工作状态

**步骤**：
1. 连接火焰传感器到PA1引脚
2. 上电启动系统
3. 观察2秒校准过程
4. 等待系统进入正常工作状态

**预期结果**：
- ✅ 校准期间显示实时电压值
- ✅ 校准完成后显示稳定电压值（1000-3000mV范围）
- ✅ 每5秒短暂显示基线值
- ✅ 无火焰时LED熄灭，继电器断开

### 3. 火焰检测测试
**目的**：验证火焰检测功能

**步骤**：
1. 在传感器前方引入火焰
2. 观察系统反应
3. 移除火焰
4. 观察延时关闭

**预期结果**：
- ✅ 检测到火焰时LED点亮
- ✅ 继电器吸合
- ✅ 火焰消失后1.5秒延时关闭
- ✅ 显示电压值明显下降

### 4. 传感器断开恢复测试
**目的**：验证传感器热插拔功能

**步骤**：
1. 系统正常工作时拔掉传感器
2. 观察系统反应
3. 重新连接传感器
4. 观察恢复过程

**预期结果**：
- ✅ 断开时立即显示"000"
- ✅ 输出立即关闭
- ✅ 重连后自动恢复正常工作
- ✅ 自动重新校准基线

## 📊 状态指示说明

| 显示内容 | 系统状态 | 说明 |
|----------|----------|------|
| 000 | 传感器断开 | 检查传感器连接 |
| 变化的数值 | 校准中 | 正在学习环境基线 |
| 1000-3000 | 正常工作 | 显示当前电压值 |
| 短暂显示低值 | 基线指示 | 每5秒显示1秒基线值 |

## 🔍 故障排除

### 如果仍然显示"上电就有火焰信号"：

1. **检查传感器连接**
   - 确保传感器正确连接到PA1引脚
   - 检查接线是否牢固

2. **检查传感器类型**
   - 确认传感器输出特性
   - 火焰存在时应该输出较低电压

3. **观察显示值**
   - 正常应该显示1000-3000mV
   - 如果显示000，说明传感器断开
   - 如果显示很低值，可能传感器故障

4. **重新校准**
   - 确保传感器正常连接
   - 重新上电让系统自动校准

### 如果传感器断开检测不工作：

1. **检查ADC配置**
   - 确认PA1引脚配置正确
   - 检查上拉电阻是否生效

2. **检查阈值设置**
   - 断开检测阈值：800mV
   - 基线范围：1000-3000mV

## ✅ 验证清单

请逐项检查以下功能：

- [ ] 无传感器时显示"000"
- [ ] 无传感器时LED熄灭
- [ ] 无传感器时继电器断开
- [ ] 连接传感器后正常显示电压值
- [ ] 火焰检测功能正常
- [ ] 延时关闭功能正常
- [ ] 基线自动校准功能正常
- [ ] 传感器热插拔功能正常

## 📞 技术支持

如果按照以上步骤测试仍有问题，请提供：
1. 具体的显示数值
2. LED和继电器的实际状态
3. 使用的传感器型号
4. 详细的连接方式

这样我们可以进一步分析和解决问题。 