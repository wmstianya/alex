# å¢žå¼ºå¼€æœºæ ¡å‡†åŠŸèƒ½è¯´æ˜Ž

## ðŸ“‹ æ¦‚è¿°
é’ˆå¯¹ç«ç„°æ£€æµ‹ç³»ç»Ÿçš„å¼€æœºæ ¡å‡†åŠŸèƒ½è¿›è¡Œäº†å…¨é¢ä¼˜åŒ–ï¼Œæ˜¾è‘—æé«˜äº†åŸºçº¿æ ¡å‡†çš„å‡†ç¡®æ€§å’Œç¨³å®šæ€§ã€‚

## ðŸŽ¯ ä¼˜åŒ–ç›®æ ‡
- æé«˜å¼€æœºé‡‡æ ·æ•°æ®çš„å‡†ç¡®æ€§
- å¢žå¼ºæ ¡å‡†è¿‡ç¨‹çš„ç¨³å®šæ€§
- æä¾›æ ¡å‡†è¿›åº¦å¯è§†åŒ–
- å®žçŽ°æ™ºèƒ½å¼‚å¸¸å€¼è¿‡æ»¤
- æ·»åŠ æ ¡å‡†è´¨é‡è¯„ä¼°

## ðŸ“Š ä¸»è¦æ”¹è¿›

### 1. é‡‡æ ·æ•°é‡ä¼˜åŒ–
- **åŽŸå§‹æ–¹æ¡ˆ**: 50æ¬¡é‡‡æ ·
- **ä¼˜åŒ–æ–¹æ¡ˆ**: 100æ¬¡é‡‡æ ·
- **æå‡æ•ˆæžœ**: ç»Ÿè®¡å‡†ç¡®æ€§æé«˜çº¦41%

### 2. æ™ºèƒ½å¼‚å¸¸å€¼è¿‡æ»¤
```c
#define CALIBRATION_OUTLIER_THRESHOLD   200     // å¼‚å¸¸å€¼é˜ˆå€¼(mV)
```
- è‡ªåŠ¨æ£€æµ‹åç¦»å¹³å‡å€¼è¶…è¿‡200mVçš„å¼‚å¸¸é‡‡æ ·
- è¿‡æ»¤çŽ¯å¢ƒå¹²æ‰°å’Œçž¬æ—¶å™ªå£°
- ç¡®ä¿æ ¡å‡†æ•°æ®çš„ä¸€è‡´æ€§

### 3. æ ¡å‡†è¿›åº¦å¯è§†åŒ–
- **è¿›åº¦æ˜¾ç¤º**: å®žæ—¶æ˜¾ç¤ºæ ¡å‡†è¿›åº¦(8000-8100)
- **æ›´æ–°é¢‘çŽ‡**: æ¯100msæ›´æ–°ä¸€æ¬¡
- **ç”¨æˆ·ä½“éªŒ**: æ¸…æ™°äº†è§£æ ¡å‡†çŠ¶æ€

### 4. ç¨³å®šæ€§è¯„ä¼°
```c
#define CALIBRATION_STABILITY_SAMPLES    10     // ç¨³å®šæ€§æ£€æŸ¥é‡‡æ ·æ•°
#define CALIBRATION_MAX_DEVIATION        50     // æœ€å¤§åå·®(mV)
```
- è®¡ç®—é‡‡æ ·æ•°æ®çš„æ³¢åŠ¨èŒƒå›´
- ç”Ÿæˆç¨³å®šæ€§è¯„åˆ†(0-100)
- æä¾›æ ¡å‡†è´¨é‡åé¦ˆ

### 5. å¢žå¼ºæ•°æ®ç»“æž„
æ–°å¢žæ ¡å‡†ç›¸å…³å­—æ®µï¼š
- `calibrationBuffer[10]`: æœ€è¿‘10æ¬¡é‡‡æ ·ç¼“å†²åŒº
- `minValue/maxValue`: æœ€å°/æœ€å¤§é‡‡æ ·å€¼
- `calibrationQuality`: æ ¡å‡†è´¨é‡è¯„åˆ†
- `lastProgressUpdate`: è¿›åº¦æ›´æ–°æ—¶é—´

## ðŸ”§ æŠ€æœ¯å®žçŽ°

### æ ¸å¿ƒç®—æ³•æµç¨‹

```mermaid
graph TD
    A[å¼€å§‹æ ¡å‡†] --> B[èŽ·å–ADCé‡‡æ ·å€¼]
    B --> C[æ›´æ–°æœ€å¤§æœ€å°å€¼]
    C --> D[å¼‚å¸¸å€¼æ£€æµ‹]
    D --> E{æ˜¯å¦å¼‚å¸¸å€¼?}
    E -->|æ˜¯| F[ä¸¢å¼ƒè¯¥é‡‡æ ·]
    E -->|å¦| G[ç´¯ç§¯æœ‰æ•ˆé‡‡æ ·]
    G --> H[æ›´æ–°è¿›åº¦æ˜¾ç¤º]
    H --> I{è¾¾åˆ°100æ¬¡é‡‡æ ·?}
    I -->|å¦| B
    I -->|æ˜¯| J[è®¡ç®—åŸºçº¿å€¼]
    J --> K[è®¡ç®—æ ¡å‡†è´¨é‡]
    K --> L[æ˜¾ç¤ºæ ¡å‡†ç»“æžœ]
    L --> M[æ ¡å‡†å®Œæˆ]
    F --> B
```

### å¼‚å¸¸å€¼æ£€æµ‹ç®—æ³•
```c
static uint8_t isOutlier(uint32_t value, uint32_t average)
{
    if(average == 0) return 0; // é¿å…é™¤é›¶
    
    uint32_t diff = (value > average) ? (value - average) : (average - value);
    return (diff > CALIBRATION_OUTLIER_THRESHOLD) ? 1 : 0;
}
```

### ç¨³å®šæ€§è®¡ç®—
```c
static uint8_t calculateStability(void)
{
    uint32_t range = detector.maxValue - detector.minValue;
    uint8_t stability = 0;
    
    if(range < CALIBRATION_MAX_DEVIATION) {
        stability = 100 - (range * 100 / CALIBRATION_MAX_DEVIATION);
    }
    
    return stability;
}
```

## ðŸ“ˆ æ€§èƒ½æå‡å¯¹æ¯”

| æŒ‡æ ‡ | åŽŸå§‹æ–¹æ¡ˆ | ä¼˜åŒ–æ–¹æ¡ˆ | æå‡å¹…åº¦ |
|------|----------|----------|----------|
| é‡‡æ ·æ¬¡æ•° | 50æ¬¡ | 100æ¬¡ | +100% |
| å¼‚å¸¸å€¼è¿‡æ»¤ | âŒ æ—  | âœ… æ™ºèƒ½è¿‡æ»¤ | æ–°å¢žåŠŸèƒ½ |
| è¿›åº¦æ˜¾ç¤º | âŒ æ—  | âœ… å®žæ—¶æ˜¾ç¤º | æ–°å¢žåŠŸèƒ½ |
| ç¨³å®šæ€§è¯„ä¼° | âŒ æ—  | âœ… 0-100è¯„åˆ† | æ–°å¢žåŠŸèƒ½ |
| æ ¡å‡†æ—¶é—´ | ~2ç§’ | ~4ç§’ | +2ç§’ |
| æ•°æ®å‡†ç¡®æ€§ | åŸºå‡† | æ˜¾è‘—æå‡ | +41% |

## ðŸŽ¯ æ˜¾ç¤ºçŠ¶æ€è¯´æ˜Ž

| æ˜¾ç¤ºèŒƒå›´ | å«ä¹‰ | è¯´æ˜Ž |
|----------|------|------|
| 8000-8100 | æ ¡å‡†è¿›åº¦ | 80XXè¡¨ç¤ºXX%è¿›åº¦ |
| æ­£å¸¸ç”µåŽ‹å€¼ | åŸºçº¿å€¼ | æ ¡å‡†å®ŒæˆåŽæ˜¾ç¤º1ç§’ |
| 9999 | æ ¡å‡†è´¨é‡å¥½ | ç¨³å®šæ€§â‰¥70åˆ† |
| 9998 | æ ¡å‡†è´¨é‡å·® | ç¨³å®šæ€§<70åˆ† |

## ðŸ› ï¸ å‚æ•°è°ƒä¼˜å»ºè®®

### çŽ¯å¢ƒç¨³å®šæ—¶
- å¯é€‚å½“é™ä½Ž`CALIBRATION_OUTLIER_THRESHOLD`åˆ°150mV
- æé«˜ç¨³å®šæ€§è¦æ±‚åˆ°80åˆ†

### çŽ¯å¢ƒå¹²æ‰°è¾ƒå¤§æ—¶
- å¯é€‚å½“æé«˜`CALIBRATION_OUTLIER_THRESHOLD`åˆ°250mV
- å¢žåŠ æ ¡å‡†é‡‡æ ·æ•°åˆ°150æ¬¡

### å¿«é€Ÿæ ¡å‡†éœ€æ±‚
- é™ä½Žé‡‡æ ·æ•°åˆ°75æ¬¡
- é€‚å½“æ”¾å®½ç¨³å®šæ€§è¦æ±‚

## ðŸ“‹ ä½¿ç”¨è¯´æ˜Ž

### æ­£å¸¸æ ¡å‡†æµç¨‹
1. **ä¸Šç”µå¯åŠ¨** â†’ ç³»ç»Ÿè‡ªåŠ¨è¿›å…¥æ ¡å‡†æ¨¡å¼
2. **è¿›åº¦æ˜¾ç¤º** â†’ æ˜¾ç¤ºå™¨æ˜¾ç¤º8000-8100(è¿›åº¦ç™¾åˆ†æ¯”)
3. **æ•°æ®é‡‡é›†** â†’ æ™ºèƒ½è¿‡æ»¤å¼‚å¸¸å€¼ï¼Œç´¯ç§¯æœ‰æ•ˆé‡‡æ ·
4. **æ ¡å‡†å®Œæˆ** â†’ æ˜¾ç¤ºåŸºçº¿å€¼(1ç§’)
5. **è´¨é‡è¯„ä¼°** â†’ æ˜¾ç¤º9999(å¥½)æˆ–9998(å·®)(1ç§’)
6. **æ­£å¸¸è¿è¡Œ** â†’ å¼€å§‹ç«ç„°æ£€æµ‹

### æ•…éšœæŽ’é™¤
| çŽ°è±¡ | åŽŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| è¿›åº¦å¡ä½ä¸åŠ¨ | å¼‚å¸¸å€¼è¿‡å¤š | æ£€æŸ¥ä¼ æ„Ÿå™¨è¿žæŽ¥ |
| æ˜¾ç¤º9998(è´¨é‡å·®) | çŽ¯å¢ƒä¸ç¨³å®š | æ”¹å–„å®‰è£…çŽ¯å¢ƒ |
| æ ¡å‡†æ—¶é—´è¿‡é•¿ | å¤§é‡å¼‚å¸¸å€¼ | æ£€æŸ¥ä¿¡å·çº¿å±è”½ |

## ðŸ” æŠ€æœ¯ä¼˜åŠ¿

1. **æ™ºèƒ½åŒ–**: è‡ªåŠ¨è¯†åˆ«å¹¶è¿‡æ»¤å¼‚å¸¸é‡‡æ ·
2. **å¯è§†åŒ–**: å®žæ—¶æ˜¾ç¤ºæ ¡å‡†è¿›åº¦å’Œè´¨é‡
3. **ç¨³å®šæ€§**: é€šè¿‡ç»Ÿè®¡å­¦æ–¹æ³•ç¡®ä¿æ•°æ®è´¨é‡
4. **çµæ´»æ€§**: å¯æ ¹æ®çŽ¯å¢ƒè°ƒæ•´å‚æ•°
5. **å¯é æ€§**: å¤šé‡éªŒè¯ç¡®ä¿æ ¡å‡†å‡†ç¡®æ€§

## ðŸ“ž æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. ä¼ æ„Ÿå™¨è¿žæŽ¥æ˜¯å¦ç‰¢å›º
2. çŽ¯å¢ƒæ˜¯å¦å­˜åœ¨å¼ºå¹²æ‰°
3. æ ¡å‡†è´¨é‡è¯„åˆ†æ˜¯å¦è¾¾æ ‡
4. åŸºçº¿å€¼æ˜¯å¦åœ¨åˆç†èŒƒå›´(1000-3000mV)

é€šè¿‡è¿™äº›å¢žå¼ºåŠŸèƒ½ï¼Œå¼€æœºæ ¡å‡†çš„å‡†ç¡®æ€§å’Œç¨³å®šæ€§å¾—åˆ°äº†æ˜¾è‘—æå‡ï¼Œä¸ºåŽç»­çš„ç«ç„°æ£€æµ‹æä¾›äº†æ›´åŠ å¯é çš„åŸºçº¿å‚è€ƒã€‚ 